<!DOCTYPE html>
<html lang="zh-cmn-Hant"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Loading Classes without Namespace via Composer - bschen</title>
    <base href="https://bschen.tw/">
    <link rel="stylesheet" href="https://bschen.tw/css/normalize.min.css">
    <link rel="stylesheet" href="https://bschen.tw/css/solarized-light.min.css">
    <link rel="stylesheet" href="https://bschen.tw/css/style.css">
</head>
<body><header>
    <nav class="breadcrumb">
        
        <a href="/">/Home</a>
        
        <a href="/posts">/Posts</a>
        
    </nav>
</header>
<div class="container">
<main id="single">
    <h1>Loading Classes without Namespace via Composer</h1>
    <h2><time datetime="2017-10-28T14:24:00&#43;0800">2017-10-28</time>
</h2>
    <section class="post-content">
        <p>沒有設定 namespace 或沒有依照 PSR-4 規範的 PHP class 檔案，依然可以透過 Composer 載入。以綠界的 SDK <a href="https://github.com/ECPay/ECPayAIO_PHP">ECPay/ECPayAIO_PHP</a> 為例，在 <code>composer.json</code> 中加入下列設定：</p>

<pre><code class="language-json">{
    &quot;autoload&quot;: {
        &quot;classmap&quot;: [
            &quot;vendor/ECPay/ECPayAIO_PHP/AioSDK/sdk&quot;
        ]
    },
    &quot;repositories&quot;: [
        {
            &quot;type&quot;: &quot;package&quot;,
            &quot;package&quot;: {
                &quot;name&quot;: &quot;ecpay/ecpayaio_php&quot;,
                &quot;version&quot;: &quot;dev-master&quot;,
                &quot;source&quot;: {
                    &quot;url&quot;: &quot;git@github.com:ECPay/ECPayAIO_PHP.git&quot;,
                    &quot;type&quot;: &quot;git&quot;,
                    &quot;reference&quot;: &quot;dev-master&quot;
                },
                &quot;dist&quot;: {
                    &quot;url&quot;: &quot;https://github.com/ECPay/ECPayAIO_PHP/archive/master.zip&quot;,
                    &quot;type&quot;: &quot;zip&quot;
                }
            }
        }
    ]
}
</code></pre>

<p>⚠️ <code>autoload.classmap</code> 那裡，因為 <code>vendor/ECPay/ECPayAIO_PHP/ApplePaySDK</code> 和 <code>vendor/ECPay/ECPayAIO_PHP/AioSDK</code> 使用了相同的 method 名稱，又沒有設定 namespace。所以如果想把路徑設為 <code>vendor/ECPay/ECPayAIO_PHP</code> 一次載入所有的 class 的話，會因為 method 名稱重複產生衝突。把 <code>ApplePaySDK</code> 和 <code>AioSDK</code> 路徑分開列入 <code>autoload.classmap</code> 也沒用，目前尚未找到解法</p>

<p>⚠️ <code>repositories.package</code> 底下，<code>source</code> 和 <code>dist</code> 根據 Composer 的安裝偏好 <code>preferred-install</code> 的設定，擇一使用即可。為了操作靈活，我就二邊都設定了</p>

<p>最後在使用 class 時，記得在開頭加上反斜線 <code>\</code> 註明是 global class</p>

<pre><code class="language-php">$ecpay = new \ECPay_AllInOne();
</code></pre>

<hr />

<ul>
<li><a href="https://getcomposer.org/doc/05-repositories.md#packages">Repositories - Composer</a></li>
<li><a href="https://getcomposer.org/doc/04-schema.md#repositories">The composer.json Schema - Composer</a></li>
<li><a href="https://blog.gotobye.com/coding/composer-from-git-project/">composer 載入 github project | Hit FM 94.87</a></li>
<li><a href="https://stackoverflow.com/a/16873912">php - How do you get composer to install a non-composer package? - Stack Overflow</a></li>
</ul>

    </section>
</main>

        </div><footer>
    <span class="footer-text">Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a></span>
</footer>
<script src="https://bschen.tw/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

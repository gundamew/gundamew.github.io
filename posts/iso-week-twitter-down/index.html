<!DOCTYPE html>
<html lang="zh-cmn-Hant"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>bschen</title>
    <base href="https://bschen.tw/">
    <link rel="stylesheet" href="/css/tachyons.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">
</head>
<body><header class="mw7 mw7-ns mv4 ph5 ph5-ns center">
    <nav class="pv2 pv2-ns ph3 ph3-ns bg-dark-blue">
        
        <a class="link dim near-white f6 f5-ns dib mr3" href="/">/Home</a>
        
        <a class="link dim near-white f6 f5-ns dib mr3" href="/posts">/Posts</a>
        
    </nav>
</header>
<div class="mw7 mw7-ns mv4 ph5 ph5-ns center">
<main>
    <h1 class="lh-title tc pa1 mb0">ISO Week Date: A Case Study of Twitter Down</h1>
    <h2 class="f4 tc mb4"><time>2014-12-29</time></h2>
    <section class="lh-copy">
        

<p>由於<strong>本週四</strong>就是 2015 年的元旦了，所以用 <a href="https://en.wikipedia.org/wiki/ISO_week_date">ISO week date</a> 記錄時間的系統，會從<strong>週一</strong>開始進入 2015 年，即使週一的日期是 2014-12-29 才對</p>

<p>摘自 Wikipedia 的說明：</p>

<blockquote>
<p>The first week of the year, hence, always <a href="https://en.wikipedia.org/wiki/ISO_week_date#First_week">contains 4 January</a>. ISO week <a href="https://en.wikipedia.org/wiki/Year_numbering">year numbering</a> therefore slightly deviates from the Gregorian for some days close to 1 January.</p>
</blockquote>

<p>關於 PHP <a href="http://php.net/manual/en/function.date.php"><code>date('o')</code></a> 的說明：</p>

<blockquote>
<p>ISO-8601 year number. This has the same value as <em>Y</em>, except that if the ISO week number (<em>W</em>) belongs to the previous or next year, that year is used instead. (added in PHP 5.1.0)</p>
</blockquote>

<p>自己測試的結果：</p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php">// 2015
echo date(&#39;o&#39;);

// 2014
echo date(&#39;Y&#39;);</code></pre></div>
<p>然後，從今早的傳言看來，Twitter 的 OAuth server 出的包可能就是因為這個……（原文已刪，連結是 <a href="https://www.facebook.com/thehackernews/posts/1051721444841728">https://www.facebook.com/thehackernews/posts/1051721444841728</a>）</p>

<h2 id="2014-12-31-edit">2014-12-31 edit</h2>

<p>從 <a href="https://news.ycombinator.com/item?id=8810157">Hacker News</a> 的消息看來，Twitter 掛站確定是這個原因了：</p>

<blockquote>
<p>If you&rsquo;re using YYYY in your JVM service or %G in anything, fix it now</p>

<p>The single character G instead of Y took down Twitter&rsquo;s API today.
If you&rsquo;re using YYYY in your JVM service or %G in anything, fix it now. You&rsquo;re very likely using the wrong year format.</p>

<p>date
Mon Dec 29 00:44:45 EST 2014</p>

<p>date -u &ldquo;+%G&rdquo;
2015</p>

<p>ISO 8601 week numbering has 2015 start this week.</p>
</blockquote>

<p>自己在 Bash 裡下指令的結果：</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ date +%Y
<span class="m">2014</span>

$ date +%G
<span class="m">2015</span>

$ date --help
%Y   year
%G   year of ISO week number <span class="o">(</span>see %V<span class="o">)</span><span class="p">;</span> normally useful only with %V
%V   ISO week number, with Monday as first day of week <span class="o">(</span><span class="m">01</span>..53<span class="o">)</span></code></pre></div>
    </section>
</main>

        </div><hr class="w-50">
<footer class="mw7 mw7-ns mb4 ph5 ph5-ns center">
    <div class="mt4">
        <span class="f6 db tc">Powered by <a href="https://gohugo.io/" target="_blank" class="link dim dark-blue fw6">Hugo</a></span>
    </div>
</footer>
</body>
</html>

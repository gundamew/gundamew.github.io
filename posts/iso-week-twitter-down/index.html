<!DOCTYPE html>
<html lang="zh-cmn-Hant"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ISO Week Date: A Case Study of Twitter Down - Bing-Sheng Chen</title>
    <base href="https://bschen.tw/">
    
    
    
    
    <link rel="stylesheet" href="https://bschen.tw/css/main.min.77a5141f9ea67f9ba748fc3698ced30b1fe5cbd999287eedeeef6263b735f340.css">
</head>
<body><header>
    <nav class="breadcrumb">
        
        <a href="/">/Home</a>
        
        <a href="/posts">/Posts</a>
        
    </nav>
</header>
<div class="container">
<main id="single">
    <h1>ISO Week Date: A Case Study of Twitter Down</h1>
    <h2><time datetime="2014-12-29T10:45:00&#43;0000">2014-12-29</time>
</h2>
    <section class="post-content">
        

<p>由於<strong>本週四</strong>就是 2015 年的元旦了，所以用 <a href="https://en.wikipedia.org/wiki/ISO_week_date">ISO week date</a> 記錄時間的系統，會從<strong>週一</strong>開始進入 2015 年，即使週一的日期是 2014-12-29 才對</p>

<p>摘自 Wikipedia 的說明：</p>

<blockquote>
<p>The first week of the year, hence, always <a href="https://en.wikipedia.org/wiki/ISO_week_date#First_week">contains 4 January</a>. ISO week <a href="https://en.wikipedia.org/wiki/Year_numbering">year numbering</a> therefore slightly deviates from the Gregorian for some days close to 1 January.</p>
</blockquote>

<p>關於 PHP <a href="http://php.net/manual/en/function.date.php"><code>date('o')</code></a> 的說明：</p>

<blockquote>
<p>ISO-8601 year number. This has the same value as <em>Y</em>, except that if the ISO week number (<em>W</em>) belongs to the previous or next year, that year is used instead. (added in PHP 5.1.0)</p>
</blockquote>

<p>自己測試的結果：</p>

<pre><code class="language-php">// 2015
echo date('o');

// 2014
echo date('Y');
</code></pre>

<p>然後，從今早的傳言看來，Twitter 的 OAuth server 出的包可能就是因為這個……（原文已刪，連結是 <a href="https://www.facebook.com/thehackernews/posts/1051721444841728">https://www.facebook.com/thehackernews/posts/1051721444841728</a>）</p>

<h2 id="2014-12-31-edit">2014-12-31 edit</h2>

<p>從 <a href="https://news.ycombinator.com/item?id=8810157">Hacker News</a> 的消息看來，Twitter 掛站確定是這個原因了：</p>

<blockquote>
<p>If you&rsquo;re using YYYY in your JVM service or %G in anything, fix it now</p>

<p>The single character G instead of Y took down Twitter&rsquo;s API today.
If you&rsquo;re using YYYY in your JVM service or %G in anything, fix it now. You&rsquo;re very likely using the wrong year format.</p>

<p>date
Mon Dec 29 00:44:45 EST 2014</p>

<p>date -u &ldquo;+%G&rdquo;
2015</p>

<p>ISO 8601 week numbering has 2015 start this week.</p>
</blockquote>

<p>自己在 Bash 裡下指令的結果：</p>

<pre><code class="language-shell">$ date +%Y
2014

$ date +%G
2015

$ date --help
%Y   year
%G   year of ISO week number (see %V); normally useful only with %V
%V   ISO week number, with Monday as first day of week (01..53)
</code></pre>

    </section>
</main>

        </div><footer>
    <span class="footer-text">Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a></span>
</footer>

<script src="https://bschen.tw/js/highlight.pack.13389e4e093fc0b3466287ead64c1f9fc3007d7703813a413de3f046ea09a346.js" integrity="sha256-EzieTgk/wLNGYofq1kwfn8MAfXcDgTpBPePwRuoJo0Y="></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
